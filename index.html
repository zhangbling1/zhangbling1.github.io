<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design Portfolio</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">

    <style>
        /* ================== 全局 ================== */
        body { margin:0; background:#f0f2f5; font-family:Inter, sans-serif; color:#111; overflow-x:hidden; }
        canvas{ position:fixed; top:0; left:0; z-index:-1; display:block; }

        nav{
            position:fixed; top:0; left:0; right:0; height:72px;
            padding:0 40px; display:flex; align-items:center; justify-content:space-between;
            background:rgba(255,255,255,.9); backdrop-filter:blur(10px);
            border-bottom:1px solid rgba(0,0,0,.05); z-index:100;
        }

        .content-layer{ min-height:100vh; display:flex; flex-direction:column; align-items:center; }

        .hero-section{ margin-top:18vh; text-align:center; }
        .hero-section h1{ font-size:5rem; margin:0; letter-spacing:-2px; }
        .word-digital{ font-weight:800; }
        .word-biology{ font-family:"Playfair Display"; font-style:italic; }

        .filter-container{
            position:sticky; top:72px; width:100%; display:flex; justify-content:center;
            background:rgba(240,242,245,.95); backdrop-filter:blur(10px);
            padding:10px 0; z-index:90;
        }
        .filter-wrapper{ display:flex; gap:8px; flex-wrap:wrap; }

        .filter-btn{
            padding:8px 20px; border-radius:40px; cursor:pointer;
            border:1px solid rgba(0,0,0,.05); background:#fff;
        }
        .filter-btn.active{ background:#111; color:#fff; }

        .galleries-wrapper{
            max-width:1600px; width:100%; padding:30px 40px 120px;
            display:flex; gap:30px; box-sizing:border-box;
        }
        .masonry-column{ flex:1; display:flex; flex-direction:column; gap:30px; }

        .photo-card{
            background:rgba(255,255,255,.85);
            border-radius:16px; overflow:hidden;
            border:1px solid rgba(255,255,255,0.6);
            box-shadow:0 4px 16px rgba(0,0,0,.04);
            opacity:0; transform:translateY(20px);
            transition:.5s;
        }
        .photo-card.reveal{ opacity:1; transform:translateY(0); }
        .photo-card:hover{ box-shadow:0 20px 40px rgba(66,133,244,.15); }

        .media-wrapper img,
        .media-wrapper video{ width:100%; display:block; }

        .card-info{ padding:12px 16px; }
        .card-tag{ font-size:.7rem; color:#4285F4; font-weight:700; }
        .card-title{ font-size:.9rem; margin:3px 0 0 0; font-weight:800; }

        /* 灯箱 */
        #lightbox{
            position:fixed; inset:0;
            background:rgba(0,0,0,.95); display:flex; align-items:center; justify-content:center;
            opacity:0; pointer-events:none; transition:.3s; z-index:999;
        }
        #lightbox.active{ opacity:1; pointer-events:auto; }
        #lightbox-content img,
        #lightbox-content video{ max-width:90%; max-height:90vh; }

        @media(max-width:900px){
            .hero-section h1{ font-size:3rem; }
            .galleries-wrapper{ padding:20px; }
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="lightbox" onclick="closeLightbox()">
    <div id="lightbox-content"></div>
</div>

<nav>
    <div class="logo">ART PORTFOLIO</div>
</nav>

<div class="content-layer">
    <div class="hero-section">
        <h1><span class="word-digital">Design</span><span class="word-biology"> Portfolio.</span></h1>
        <p>Latest works collection</p>
    </div>

    <div class="filter-container">
        <div id="filters" class="filter-wrapper"></div>
    </div>

    <div id="galleries-root" class="galleries-wrapper"></div>
</div>

<script>
/* ---------------- 配置 ---------------- */
const CATEGORIES = [
    { id:"CG Style", name:"CG风格" },
    { id:"Cartoon", name:"欧美卡通" },
    { id:"Icon Design", name:"Icon设计" },
    { id:"Character", name:"角色原画" },
    { id:"Other", name:"其他类型" },
];

const EXTENSIONS = ['.webp','.jpg','.png','.jpeg','.gif','.mp4','.mov'];
const MAX_SEARCH = 300;

/* ---------------- 状态 ---------------- */
let loadedItems = [];
let currentFilter = "all";
let columnsDOM = [];

/* ---------------- 初始化 ---------------- */
window.onload = () => {
    buildFilters();
    buildColumns();
    CATEGORIES.forEach((c,i)=>smartScan(c,1));
};

/* ---------------- 分类按钮 ---------------- */
function buildFilters(){
    addFilter("all","全部");
    CATEGORIES.forEach(c=>addFilter(c.id,c.name));
}
function addFilter(id,label){
    const el = document.createElement("div");
    el.className = "filter-btn" + (id==="all"?" active":"");
    el.innerText = label;
    el.onclick = ()=>{
        document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
        el.classList.add("active");
        currentFilter = id;
        layout();
    };
    filters.appendChild(el);
}

/* ---------------- 扫描文件 ---------------- */
async function smartScan(category,index,error=0){
    if(index>MAX_SEARCH) return;

    const checks = EXTENSIONS.map(ext => new Promise(resolve=>{
        const url = `images/${category.id}/${index}${ext}`;
        const isVideo = ext==='.mp4' || ext==='.mov';

        if(isVideo){
            const v=document.createElement("video");
            v.src=url;
            v.onloadedmetadata=()=>resolve({ok:true,src:url,w:v.videoWidth||1600,h:v.videoHeight||900});
            v.onerror=()=>resolve({ok:false});
        }else{
            const img=new Image();
            img.src=url;
            img.onload=()=>resolve({ok:true,src:url,w:img.width,h:img.height});
            img.onerror=()=>resolve({ok:false});
        }
    }));

    const results = await Promise.all(checks);
    const ok = results.find(r=>r.ok);

    if(ok){
        addItem(ok.src,category,ok.w,ok.h);
        smartScan(category,index+1,0);
    }else{
        smartScan(category,index+1,error+1);
    }
}

/* ---------------- 添加卡片 ---------------- */
function addItem(src,category,w,h){
    const item={
        src, cat:category.id, w, h, ratio:w/h
    };
    loadedItems.push(item);
    layout();
}

/* ---------------- 构建列 ---------------- */
function buildColumns(){
    galleriesRoot.innerHTML="";
    columnsDOM=[];

    let count=4;
    if(innerWidth<900) count=2;
    if(innerWidth<600) count=1;

    for(let i=0;i<count;i++){
        const c=document.createElement("div");
        c.className="masonry-column";
        galleriesRoot.appendChild(c);
        columnsDOM.push(c);
    }
}
window.onresize=()=>{ buildColumns(); layout(); };

/* ---------------- 布局算法 ---------------- */
function layout(){
    if(columnsDOM.length===0) buildColumns();
    columnsDOM.forEach(c=>c.innerHTML="");

    const filtered = currentFilter==="all"
        ? loadedItems
        : loadedItems.filter(i=>i.cat===currentFilter);

    const heights = new Array(columnsDOM.length).fill(0);

    filtered.forEach(item=>{
        const colIndex = heights.indexOf(Math.min(...heights));
        const column = columnsDOM[colIndex];

        const card = document.createElement("div");
        card.className="photo-card";

        const mediaWrapper=document.createElement("div");
        mediaWrapper.className="media-wrapper";

        if(item.src.endsWith(".mp4") || item.src.endsWith(".mov")){
            const v=document.createElement("video");
            v.src=item.src;
            v.muted=true; v.loop=true; v.autoplay=true; v.playsInline=true;
            mediaWrapper.appendChild(v);
        }else{
            const img=document.createElement("img");
            img.src=item.src;
            mediaWrapper.appendChild(img);
        }

        const info=document.createElement("div");
        info.className="card-info";
        info.innerHTML=`<div class="card-tag">${item.cat}</div>
                        <div class="card-title">${item.src.split('/').pop()}</div>`;

        card.appendChild(mediaWrapper);
        card.appendChild(info);
        card.onclick=()=>openLightbox(item.src);

        setTimeout(()=>card.classList.add("reveal"),50);

        column.appendChild(card);
        heights[colIndex]+= (300/item.ratio)+80;
    });
}

/* ---------------- 灯箱 ---------------- */
function openLightbox(src){
    lightbox.classList.add("active");
    lightboxContent.innerHTML="";

    if(src.endsWith(".mp4")||src.endsWith(".mov")){
        const v=document.createElement("video");
        v.src=src; v.controls=true; v.autoplay=true;
        lightboxContent.appendChild(v);
    }else{
        const img=document.createElement("img");
        img.src=src;
        lightboxContent.appendChild(img);
    }
}
function closeLightbox(){ lightbox.classList.remove("active"); }

/* ---------------- 简单粒子背景 ---------------- */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let particles=[];
function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }
resize(); window.onresize=resize;

for(let i=0;i<120;i++){
    particles.push({
        x:Math.random()*innerWidth,
        y:Math.random()*innerHeight,
        vx:(Math.random()-.5)*0.5,
        vy:(Math.random()-.5)*0.5,
        r:Math.random()*2+1
    });
}
function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
        p.x+=p.vx; p.y+=p.vy;
        if(p.x<0||p.x>innerWidth) p.vx*=-1;
        if(p.y<0||p.y>innerHeight) p.vy*=-1;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle="rgba(120,160,255,.4)";
        ctx.fill();
    });
    requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
